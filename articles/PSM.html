<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with PSM data • PSMatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with PSM data">
<meta property="og:description" content="PSMatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PSMatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AdjacencyMatrix.html">Understanding protein groups with adjacency matrices</a>
    </li>
    <li>
      <a href="../articles/Fragments.html">MS2 fragment ions</a>
    </li>
    <li>
      <a href="../articles/PSM.html">Working with PSM data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RforMassSpectrometry/PSM/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with PSM data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/PSM/blob/HEAD/vignettes/PSM.Rmd" class="external-link"><code>vignettes/PSM.Rmd</code></a></small>
      <div class="hidden name"><code>PSM.Rmd</code></div>

    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Package</strong>: <em><a href="https://bioconductor.org/packages/3.15/PSMatch" class="external-link">PSMatch</a></em><br><strong>Authors</strong>: Laurent Gatto [aut, cre] (<a href="https://orcid.org/0000-0002-1520-2268" class="external-link uri">https://orcid.org/0000-0002-1520-2268</a>), Johannes Rainer
[aut] (<a href="https://orcid.org/0000-0002-6977-7147" class="external-link uri">https://orcid.org/0000-0002-6977-7147</a>), Sebastian Gibb
[aut], Samuel Wieczorek [ctb], Thomas Burger [ctb]<br><strong>Last
modified:</strong> 2022-03-07 06:04:17<br><strong>Compiled</strong>:
Mon Mar 7 07:04:10 2022</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette is one among several illustrating how to use the
<code>PSMatch</code> package, focusing on the handling and processing of
proteomics identification data using the <code>PSM</code> class. For a
general overview of the package, see the <code>PSMatch</code> package
manual page (<code><a href="../reference/PSMatch.html">?PSMatch</a></code>) and references therein.</p>
</div>
<div class="section level2">
<h2 id="handling-and-processing-identification-data">Handling and processing identification data<a class="anchor" aria-label="anchor" href="#handling-and-processing-identification-data"></a>
</h2>
<div class="section level3">
<h3 id="loading-psm-data">Loading PSM data<a class="anchor" aria-label="anchor" href="#loading-psm-data"></a>
</h3>
<p>We are going to use an <code>mzid</code> file from the
<code>msdata</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">msdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/msdata/man/proteomics.html" class="external-link">ident</a></span><span class="op">(</span>full.names <span class="op">=</span> <span class="cn">TRUE</span>, pattern <span class="op">=</span> <span class="st">"TMT"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01-20141210.mzid"</span></code></pre>
<p>The <code><a href="../reference/PSM.html">PSM()</a></code> function parses one or multiple
<code>mzid</code> files and returns an object of class <code>PSM</code>.
This class is a simple extension of the <code>DFrame</code> class,
representing the peptide-spectrum matches in a tabular format.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/RforMassSpectrometry/PSM" class="external-link">"PSMatch"</a></span><span class="op">)</span>
<span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSM.html">PSM</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Loading required namespace: mzR</span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span></code></pre></div>
<pre><code><span class="co">## PSM with 5802 rows and 35 columns.</span>
<span class="co">## names(35): sequence spectrumID ... subReplacementResidue subLocation</span></code></pre>
<p>This table contains 5802 matches for 5343 scans and 4938 peptides
sequences, each annotated by 35 variables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="co">## number of matches</span></code></pre></div>
<pre><code><span class="co">## [1] 5802</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">$</span><span class="va">spectrumID</span><span class="op">)</span><span class="op">)</span> <span class="co">## number of scans</span></code></pre></div>
<pre><code><span class="co">## [1] 5343</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">$</span><span class="va">sequence</span><span class="op">)</span><span class="op">)</span>   <span class="co">## number of peptide sequences</span></code></pre></div>
<pre><code><span class="co">## [1] 4938</span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "sequence"                 "spectrumID"              </span>
<span class="co">##  [3] "chargeState"              "rank"                    </span>
<span class="co">##  [5] "passThreshold"            "experimentalMassToCharge"</span>
<span class="co">##  [7] "calculatedMassToCharge"   "peptideRef"              </span>
<span class="co">##  [9] "modNum"                   "isDecoy"                 </span>
<span class="co">## [11] "post"                     "pre"                     </span>
<span class="co">## [13] "start"                    "end"                     </span>
<span class="co">## [15] "DatabaseAccess"           "DBseqLength"             </span>
<span class="co">## [17] "DatabaseSeq"              "DatabaseDescription"     </span>
<span class="co">## [19] "scan.number.s."           "acquisitionNum"          </span>
<span class="co">## [21] "spectrumFile"             "idFile"                  </span>
<span class="co">## [23] "MS.GF.RawScore"           "MS.GF.DeNovoScore"       </span>
<span class="co">## [25] "MS.GF.SpecEValue"         "MS.GF.EValue"            </span>
<span class="co">## [27] "MS.GF.QValue"             "MS.GF.PepQValue"         </span>
<span class="co">## [29] "modPeptideRef"            "modName"                 </span>
<span class="co">## [31] "modMass"                  "modLocation"             </span>
<span class="co">## [33] "subOriginalResidue"       "subReplacementResidue"   </span>
<span class="co">## [35] "subLocation"</span></code></pre>
<p>The PSM data are read as is, without any filtering. As we can see
below, we still have all the hits from the forward and reverse (decoy)
databases.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">id</span><span class="op">$</span><span class="va">isDecoy</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## FALSE  TRUE </span>
<span class="co">##  2906  2896</span></code></pre>
</div>
<div class="section level3">
<h3 id="keeping-all-matches">Keeping all matches<a class="anchor" aria-label="anchor" href="#keeping-all-matches"></a>
</h3>
<p>The data also contains multiple matches for several spectra. The
table below shows the number of individual MS scans that have 1, 2, … up
to 5 matches.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">id</span><span class="op">$</span><span class="va">spectrumID</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##    1    2    3    4    5 </span>
<span class="co">## 4936  369   26   10    2</span></code></pre>
<p>More specifically, we can see below how scan 1774 has 4 matches, all
to sequence <code>RTRYQAEVR</code>, which itself matches to 4 different
proteins:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"scan=1774"</span>, <span class="va">id</span><span class="op">$</span><span class="va">spectrumID</span><span class="op">)</span>
<span class="va">id</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></code></pre></div>
<pre><code><span class="co">## PSM with 4 rows and 35 columns.</span>
<span class="co">## names(35): sequence spectrumID ... subReplacementResidue subLocation</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span><span class="op">[</span><span class="va">i</span>, <span class="st">"DatabaseAccess"</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## [1] "ECA2104" "ECA2867" "ECA3427" "ECA4142"</span></code></pre>
<p>If the goal is to keep all the matches, but arranged by
scan/spectrum, one can <em>reduce</em> the <code>DataFrame</code> object
by the <code>spectrumID</code> variable, so that each scan correponds to
a single row that still stores all values<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSM.html">reducePSMs</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">id</span><span class="op">$</span><span class="va">spectrumID</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co">## rownames not needed here</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 5343   35</span></code></pre>
<p>The resulting object contains a single entrie for scan 1774 with
information for the multiple matches stored as a list within the table
cell.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"scan=1774"</span>, <span class="va">id2</span><span class="op">$</span><span class="va">spectrumID</span><span class="op">)</span>
<span class="va">id2</span><span class="op">[</span><span class="va">j</span>, <span class="op">]</span></code></pre></div>
<pre><code><span class="co">## Reduced PSM with 1 rows and 35 columns.</span>
<span class="co">## names(35): sequence spectrumID ... subReplacementResidue subLocation</span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id2</span><span class="op">[</span><span class="va">j</span>, <span class="st">"DatabaseAccess"</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## CharacterList of length 1</span>
<span class="co">## [["controllerType=0 controllerNumber=1 scan=1774"]] ECA2104 ECA2867 ECA3427 ECA4142</span></code></pre>
<p>The identification data could be used to annotate an raw mass
spectrometry <code>Spectra</code> object (see the
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::joinSpectraData()</a></code> function for details).</p>
</div>
<div class="section level3">
<h3 id="filtering-data">Filtering data<a class="anchor" aria-label="anchor" href="#filtering-data"></a>
</h3>
<p>Often, the PSM data is filtered to only retain reliable matches. The
<code>MSnID</code> package can be used to set thresholds to attain
user-defined PSM, peptide or protein-level FDRs. Here, we will simply
filter out wrong or the least reliable identifications.</p>
<div class="section level4">
<h4 id="remove-decoy-hits">Remove decoy hits<a class="anchor" aria-label="anchor" href="#remove-decoy-hits"></a>
</h4>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterPSMs.html">filterPsmDecoy</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Removed 2896 decoy hits.</span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span></code></pre></div>
<pre><code><span class="co">## PSM with 2906 rows and 35 columns.</span>
<span class="co">## names(35): sequence spectrumID ... subReplacementResidue subLocation</span></code></pre>
</div>
<div class="section level4">
<h4 id="keep-first-rank-matches">Keep first rank matches<a class="anchor" aria-label="anchor" href="#keep-first-rank-matches"></a>
</h4>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterPSMs.html">filterPsmRank</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Removed 155 PSMs with rank &gt; 1.</span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span></code></pre></div>
<pre><code><span class="co">## PSM with 2751 rows and 35 columns.</span>
<span class="co">## names(35): sequence spectrumID ... subReplacementResidue subLocation</span></code></pre>
</div>
<div class="section level4">
<h4 id="remove-shared-peptides">Remove shared peptides<a class="anchor" aria-label="anchor" href="#remove-shared-peptides"></a>
</h4>
<p>The data still contains shared peptides, i.e. those that different
proteins. For example <code>QKTRCATRAFKANKGRAR</code> matches proteins
<code>ECA2869</code> and <code>ECA4278</code>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span><span class="op">[</span><span class="va">id</span><span class="op">$</span><span class="va">sequence</span> <span class="op">==</span> <span class="st">"QKTRCATRAFKANKGRAR"</span>, <span class="st">"DatabaseAccess"</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## [1] "ECA2869" "ECA4278"</span></code></pre>
<p>We can filter these out to retain unique peptides.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterPSMs.html">filterPsmShared</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Removed 85 shared peptides.</span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span></code></pre></div>
<pre><code><span class="co">## PSM with 2666 rows and 35 columns.</span>
<span class="co">## names(35): sequence spectrumID ... subReplacementResidue subLocation</span></code></pre>
<p>This last filtering leaves us with 2666 PSMs.</p>
<p>Note that the <code>ConnectedComponents</code> approach defined in
this package allows one to explore protein groups defined by such shared
peptides more thoroughly and make informed decision as to which shared
peptides to retain and which ones to drop. For details see the related
vignette or the <a href="https://rformassspectrometry.github.io/PSMatch/reference/ConnectedComponents.html" class="external-link"><code>ConnectedComponents</code></a>
manual page.</p>
</div>
<div class="section level4">
<h4 id="all-filters-in-one-function">All filters in one function<a class="anchor" aria-label="anchor" href="#all-filters-in-one-function"></a>
</h4>
<p>This can also be achieved with the <code><a href="../reference/filterPSMs.html">filterPSMs()</a></code>
function:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSM.html">PSM</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="fu"><a href="../reference/filterPSMs.html">filterPSMs</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Starting with 5802 PSMs:</span></code></pre>
<pre><code><span class="co">## Removed 2896 decoy hits.</span></code></pre>
<pre><code><span class="co">## Removed 155 PSMs with rank &gt; 1.</span></code></pre>
<pre><code><span class="co">## Removed 85 shared peptides.</span></code></pre>
<pre><code><span class="co">## 2666 PSMs left.</span></code></pre>
<pre><code><span class="co">## PSM with 2666 rows and 35 columns.</span>
<span class="co">## names(35): sequence spectrumID ... subReplacementResidue subLocation</span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="the-mzr-and-mzid-parsers">The <code>mzR</code> and <code>mzID</code> parsers<a class="anchor" aria-label="anchor" href="#the-mzr-and-mzid-parsers"></a>
</h2>
<p>The <code><a href="../reference/PSM.html">PSM()</a></code> function can take two different values for the
<code>parser</code> parameter, namely <code>"mzR"</code> (the default
value) and <code>"mzID"</code>.</p>
<ul>
<li><p><strong>mzR</strong> uses the <code>openIDfile()</code> function
from the <em><a href="https://bioconductor.org/packages/3.15/mzR" class="external-link">mzR</a></em> to parse
the <code>mzId</code> file(s), and then coerces the data to a
<code>data.frame</code> which is eventually returned as a
<code>PSM</code> object. The parser function uses dedicated code from
the Proteowizard project (included in <code>mzR</code>) and is generally
the fastest approach.</p></li>
<li><p><strong>mzID</strong> parses the <code>mzId</code> file with
<code>mzID()</code> function from the <em><a href="https://bioconductor.org/packages/3.15/mzID" class="external-link">mzID</a></em>
package, and then flattens the data to a <code>data.frame</code> with
<code><a href="https://rdrr.io/pkg/mzID/man/flatten.html" class="external-link">mzID::flatten()</a></code> and eventuelly returns a <code>PSM</code>
object. The <code>mzID</code> package relies on the <em><a href="https://CRAN.R-project.org/package=XML" class="external-link">XML</a></em> package. Is
is slower but is is more robust to variations in the <code>mzID</code>
implementation, as is thus a useful backup when the <code>mzR</code>
backend fails.</p></li>
</ul>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">id1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSM.html">PSM</a></span><span class="op">(</span><span class="va">f</span>, parser <span class="op">=</span> <span class="st">"mzR"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    user  system elapsed </span>
<span class="co">##   0.299   0.012   0.311</span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">id2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PSM.html">PSM</a></span><span class="op">(</span><span class="va">f</span>, parser <span class="op">=</span> <span class="st">"mzID"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Loading required namespace: mzID</span></code></pre>
<pre><code><span class="co">## reading TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01-20141210.mzid... DONE!</span></code></pre>
<pre><code><span class="co">##    user  system elapsed </span>
<span class="co">##   9.338   0.072   9.410</span></code></pre>
<p>Other differences in the two parsers include the columns that are
returned, the way they name them, and, as will shown below the matches
that are returned. Note for instance (and this will be important later),
that there is no equivalent of <code>"modLocation"</code> in
<code>id2</code>.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">id1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "sequence"                 "spectrumID"              </span>
<span class="co">##  [3] "chargeState"              "rank"                    </span>
<span class="co">##  [5] "passThreshold"            "experimentalMassToCharge"</span>
<span class="co">##  [7] "calculatedMassToCharge"   "peptideRef"              </span>
<span class="co">##  [9] "modNum"                   "isDecoy"                 </span>
<span class="co">## [11] "post"                     "pre"                     </span>
<span class="co">## [13] "start"                    "end"                     </span>
<span class="co">## [15] "DatabaseAccess"           "DBseqLength"             </span>
<span class="co">## [17] "DatabaseSeq"              "DatabaseDescription"     </span>
<span class="co">## [19] "scan.number.s."           "acquisitionNum"          </span>
<span class="co">## [21] "spectrumFile"             "idFile"                  </span>
<span class="co">## [23] "MS.GF.RawScore"           "MS.GF.DeNovoScore"       </span>
<span class="co">## [25] "MS.GF.SpecEValue"         "MS.GF.EValue"            </span>
<span class="co">## [27] "MS.GF.QValue"             "MS.GF.PepQValue"         </span>
<span class="co">## [29] "modPeptideRef"            "modName"                 </span>
<span class="co">## [31] "modMass"                  "modLocation"             </span>
<span class="co">## [33] "subOriginalResidue"       "subReplacementResidue"   </span>
<span class="co">## [35] "subLocation"</span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "spectrumid"                "scan number(s)"           </span>
<span class="co">##  [3] "acquisitionnum"            "passthreshold"            </span>
<span class="co">##  [5] "rank"                      "calculatedmasstocharge"   </span>
<span class="co">##  [7] "experimentalmasstocharge"  "chargestate"              </span>
<span class="co">##  [9] "ms-gf:denovoscore"         "ms-gf:evalue"             </span>
<span class="co">## [11] "ms-gf:pepqvalue"           "ms-gf:qvalue"             </span>
<span class="co">## [13] "ms-gf:rawscore"            "ms-gf:specevalue"         </span>
<span class="co">## [15] "assumeddissociationmethod" "isotopeerror"             </span>
<span class="co">## [17] "isdecoy"                   "post"                     </span>
<span class="co">## [19] "pre"                       "end"                      </span>
<span class="co">## [21] "start"                     "accession"                </span>
<span class="co">## [23] "length"                    "description"              </span>
<span class="co">## [25] "pepseq"                    "modified"                 </span>
<span class="co">## [27] "modification"              "idFile"                   </span>
<span class="co">## [29] "spectrumFile"              "databaseFile"</span></code></pre>
<p>We also have different number of matches in the two tables:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">id1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 5802</span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 5759</span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">id1</span><span class="op">$</span><span class="va">isDecoy</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## FALSE  TRUE </span>
<span class="co">##  2906  2896</span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">id2</span><span class="op">$</span><span class="va">isdecoy</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## FALSE  TRUE </span>
<span class="co">##  2886  2873</span></code></pre>
<p>Let’s first filter the PSM tables to facilitate focus the comparison
of relevant scans. Note that the default <code><a href="../reference/filterPSMs.html">filterPSMs()</a></code>
arguments are set to work with both parser.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id1_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterPSMs.html">filterPSMs</a></span><span class="op">(</span><span class="va">id1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Starting with 5802 PSMs:</span></code></pre>
<pre><code><span class="co">## Removed 2896 decoy hits.</span></code></pre>
<pre><code><span class="co">## Removed 155 PSMs with rank &gt; 1.</span></code></pre>
<pre><code><span class="co">## Removed 85 shared peptides.</span></code></pre>
<pre><code><span class="co">## 2666 PSMs left.</span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id2_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterPSMs.html">filterPSMs</a></span><span class="op">(</span><span class="va">id2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Starting with 5759 PSMs:</span></code></pre>
<pre><code><span class="co">## Removed 2873 decoy hits.</span></code></pre>
<pre><code><span class="co">## Removed 155 PSMs with rank &gt; 1.</span></code></pre>
<pre><code><span class="co">## Removed 85 shared peptides.</span></code></pre>
<pre><code><span class="co">## 2646 PSMs left.</span></code></pre>
<p>As can be seen, we are also left with 2666 vs 2646 PSMs after
filtering.</p>
<p>The difference doesn’t stem from different scans, given that the
spectum identifiers are identical in both tables:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id1_filtered</span><span class="op">$</span><span class="va">spectrumID</span><span class="op">)</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id2_filtered</span><span class="op">$</span><span class="va">spectrumid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<p>The difference is obvious when we tally a table of spectrum id
occurences in the filtered tables. In <code>id2_filtered</code>, each
scan is unique, i.e matched only once.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">anyDuplicated</a></span><span class="op">(</span><span class="va">id2_filtered</span><span class="op">$</span><span class="va">spectrumid</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0</span></code></pre>
<p>However, for <code>id1_filtered</code>, we see that some scans are
still repeat up to 4 times in the table:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">id1_filtered</span><span class="op">$</span><span class="va">spectrumID</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##    1    2    3    4 </span>
<span class="co">## 2630   13    2    1</span></code></pre>
<p>The example below shows that these differences stem from the
modification location (<code>"modLocation"</code>), that is not report
by the <code>mzID</code> parser:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">id1_filtered</span><span class="op">$</span><span class="va">spectrumID</span><span class="op">)</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">id1_filtered</span><span class="op">[</span><span class="va">id1_filtered</span><span class="op">$</span><span class="va">spectrumID</span> <span class="op">==</span> <span class="va">k</span>, <span class="st">"sequence"</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## [1] "KCNQCLKVACTLFYCK" "KCNQCLKVACTLFYCK" "KCNQCLKVACTLFYCK" "KCNQCLKVACTLFYCK"</span></code></pre>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id1_filtered</span><span class="op">[</span><span class="va">id1_filtered</span><span class="op">$</span><span class="va">spectrumID</span> <span class="op">==</span> <span class="va">k</span>, <span class="st">"modLocation"</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## [1]  2  5 10 15</span></code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id1_filtered</span><span class="op">[</span><span class="va">id1_filtered</span><span class="op">$</span><span class="va">spectrumID</span> <span class="op">==</span> <span class="va">k</span>, <span class="st">"modName"</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">## [1] "Carbamidomethyl" "Carbamidomethyl" "Carbamidomethyl" "Carbamidomethyl"</span></code></pre>
<p>If we remove the <code>"modLocation"</code> column, we recoved the
same number of PSMs than with the <code>mzID</code> parser.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id1_filtered</span><span class="op">$</span><span class="va">modLocation</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id1_filtered</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 2646</span></code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id2_filtered</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 2646</span></code></pre>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## R Under development (unstable) (2022-03-03 r81847)</span>
<span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">## Running under: Ubuntu 20.04.4 LTS</span>
<span class="co">## </span>
<span class="co">## Matrix products: default</span>
<span class="co">## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so</span>
<span class="co">## </span>
<span class="co">## locale:</span>
<span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span>
<span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">## </span>
<span class="co">## attached base packages:</span>
<span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span>
<span class="co">## [8] base     </span>
<span class="co">## </span>
<span class="co">## other attached packages:</span>
<span class="co">## [1] PSMatch_0.99.1      S4Vectors_0.33.10   BiocGenerics_0.41.2</span>
<span class="co">## [4] BiocStyle_2.23.1   </span>
<span class="co">## </span>
<span class="co">## loaded via a namespace (and not attached):</span>
<span class="co">##  [1] Rcpp_1.0.8                  msdata_0.35.2              </span>
<span class="co">##  [3] lattice_0.20-45             foreach_1.5.2              </span>
<span class="co">##  [5] rprojroot_2.0.2             digest_0.6.29              </span>
<span class="co">##  [7] plyr_1.8.6                  R6_2.5.1                   </span>
<span class="co">##  [9] GenomeInfoDb_1.31.4         mzID_1.33.0                </span>
<span class="co">## [11] evaluate_0.15               zlibbioc_1.41.0            </span>
<span class="co">## [13] rlang_1.0.2                 lazyeval_0.2.2             </span>
<span class="co">## [15] jquerylib_0.1.4             Matrix_1.4-0               </span>
<span class="co">## [17] rmarkdown_2.12              mzR_2.29.3                 </span>
<span class="co">## [19] pkgdown_2.0.2.9000          textshaping_0.3.6          </span>
<span class="co">## [21] desc_1.4.1                  BiocParallel_1.29.15       </span>
<span class="co">## [23] stringr_1.4.0               ProtGenerics_1.27.2        </span>
<span class="co">## [25] igraph_1.2.11               RCurl_1.98-1.6             </span>
<span class="co">## [27] DelayedArray_0.21.2         compiler_4.2.0             </span>
<span class="co">## [29] xfun_0.30                   pkgconfig_2.0.3            </span>
<span class="co">## [31] systemfonts_1.0.4           htmltools_0.5.2            </span>
<span class="co">## [33] SummarizedExperiment_1.25.3 GenomeInfoDbData_1.2.7     </span>
<span class="co">## [35] bookdown_0.24               codetools_0.2-18           </span>
<span class="co">## [37] IRanges_2.29.1              matrixStats_0.61.0         </span>
<span class="co">## [39] XML_3.99-0.9                MASS_7.3-55                </span>
<span class="co">## [41] bitops_1.0-7                grid_4.2.0                 </span>
<span class="co">## [43] jsonlite_1.8.0              AnnotationFilter_1.19.0    </span>
<span class="co">## [45] magrittr_2.0.2              MsCoreUtils_1.7.4          </span>
<span class="co">## [47] ncdf4_1.19                  cli_3.2.0                  </span>
<span class="co">## [49] stringi_1.7.6               cachem_1.0.6               </span>
<span class="co">## [51] XVector_0.35.0              fs_1.5.2                   </span>
<span class="co">## [53] doParallel_1.0.17           MultiAssayExperiment_1.21.5</span>
<span class="co">## [55] bslib_0.3.1                 ragg_1.2.2                 </span>
<span class="co">## [57] iterators_1.0.14            tools_4.2.0                </span>
<span class="co">## [59] QFeatures_1.5.2             Biobase_2.55.0             </span>
<span class="co">## [61] purrr_0.3.4                 MatrixGenerics_1.7.0       </span>
<span class="co">## [63] parallel_4.2.0              fastmap_1.1.0              </span>
<span class="co">## [65] yaml_2.3.5                  clue_0.3-60                </span>
<span class="co">## [67] cluster_2.1.2               BiocManager_1.30.16        </span>
<span class="co">## [69] GenomicRanges_1.47.6        memoise_2.0.1              </span>
<span class="co">## [71] knitr_1.37                  sass_0.4.0</span></code></pre>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>The rownames aren’t needed here and are removed to
reduce to output in the the next code chunks displaying parts of
<code>id2</code>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
