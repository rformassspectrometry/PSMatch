<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>A class for peptide-spectrum matches results — PSM • PSM</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="A class for peptide-spectrum matches results — PSM" />
<meta property="og:description" content="The PSM class is a simple class to store and manipulate
peptide-spectrum matches. The class encapsulates PSM data as a
DataFrame (or more specifically a DFrame) with additional
lightweight metadata annotation.
There are two types of PSM objects:
Objects with duplicated spectrum identifiers. This holds for
multiple matches to the same spectrum, be it different peptide
sequences or the same sequence with or without a
post-translational modification. Such objects are typically
created with the PSM() constructor starting from mzIdentML
files.
Reduced object where the spectrum identifiers (or any equivalent
column - see example below) are unique keys within the PSM
table. Matches to the same scan/spectrum in each raw data file
are merged into a single data row. Reduced PSM object are
created with the reducePSMs() function. See examples below.


Objects can be checked for their reduced state with the
reduced() function which returns TRUE for reduced instances,
FALSE when the spectrum identifiers are duplicated, or NA when
unknown. The flag can also be set explicitly with the
reduced()&amp;lt;- setter.
The constructor uses parsers provided by the mzR or mzID
packages to read the mzIdentML data. See the vignette for some
apparent differences in their outputs." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



<!-- dependencies from examples -->


  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PSM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/PSM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/RforMassSpectrometry/PSM/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>A class for peptide-spectrum matches results</h1>
    <small class="dont-index">Source: <a href='https://github.com/RforMassSpectrometry/PSM/blob/master/R/PSM-class.R'><code>R/PSM-class.R</code></a>, <a href='https://github.com/RforMassSpectrometry/PSM/blob/master/R/reducePSMs.R'><code>R/reducePSMs.R</code></a></small>
    <div class="hidden name"><code>PSM.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>PSM</code> class is a simple class to store and manipulate
peptide-spectrum matches. The class encapsulates PSM data as a
<code>DataFrame</code> (or more specifically a <code>DFrame</code>) with additional
lightweight metadata annotation.</p>
<p>There are two types of <code>PSM</code> objects:</p><ul>
<li><p>Objects with duplicated spectrum identifiers. This holds for
multiple matches to the same spectrum, be it different peptide
sequences or the same sequence with or without a
post-translational modification. Such objects are typically
created with the <code>PSM()</code> constructor starting from <code>mzIdentML</code>
files.</p></li>
<li><p>Reduced object where the spectrum identifiers (or any equivalent
column - see example below) are unique keys within the PSM
table. Matches to the same scan/spectrum in each raw data file
are merged into a single data row. Reduced <code>PSM</code> object are
created with the <code>reducePSMs()</code> function. See examples below.</p></li>
</ul>

<p>Objects can be checked for their reduced state with the
<code>reduced()</code> function which returns TRUE for reduced instances,
FALSE when the spectrum identifiers are duplicated, or NA when
unknown. The flag can also be set explicitly with the
<code>reduced()&lt;-</code> setter.</p>
<p>The constructor uses parsers provided by the <code>mzR</code> or <code>mzID</code>
packages to read the <code>mzIdentML</code> data. See the vignette for some
apparent differences in their outputs.</p>
    </div>

    <pre class="usage"><span class='fu'>PSM</span><span class='op'>(</span><span class='va'>files</span>, parser <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"mzR"</span>, <span class='st'>"mzID"</span><span class='op'>)</span>, BPPARAM <span class='op'>=</span> <span class='fu'>SerialParam</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>reduced</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>spectrumID</span><span class='op'>)</span>

<span class='fu'>reduced</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='va'>value</span>

<span class='fu'>reducePSMs</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>k</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>files</th>
      <td><p><code><a href='https://rdrr.io/r/base/character.html'>character()</a></code> of <code>mzid</code> file names.</p></td>
    </tr>
    <tr>
      <th>parser</th>
      <td><p><code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> defining the parser to be used to
read the <code>mzIdentML</code> files. One of <code>"mzR"</code> (default) or
<code>"mzID"</code>.</p></td>
    </tr>
    <tr>
      <th>BPPARAM</th>
      <td><p>an object inheriting from BiocParallelParam to
control parallel processing. The default value is
<code>SerialParam()</code> to read files in series.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>An instance of class <code>PSM</code>.</p></td>
    </tr>
    <tr>
      <th>spectrumID</th>
      <td><p><code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code> with the column name referring to
the spectrum identifier or any other unique key for the <code>PSM</code>
object <code>x</code>. This parameter can be set to calculate the reduced
state explicitly by by-passing the <code>reduced</code> metadata flag.</p></td>
    </tr>
    <tr>
      <th>value</th>
      <td><p><code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code> to set the reduced state of the <code>PSM</code>
object.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>A <code>vector</code> or <code>factor</code> of length equal to <code><a href='https://rdrr.io/r/base/nrow.html'>nrow(x)</a></code> that
defines the primary key used to reduce <code>x</code>. This typically
corresponds to the spectrum identifier, often names
<code>spectrumID</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>PSM()</code> returns a <code>PSM</code> object containing the
peptide-spectrum matches stored in <code>files</code>.</p>
<p><code>reducePSMs()</code> returns a reduced version of the <code>x</code> input.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>## ---------------------------------</span>
<span class='co'>## Example with a single mzid file</span>
<span class='co'>## ---------------------------------</span>

<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='fu'>msdata</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/msdata/man/proteomics.html'>ident</a></span><span class='op'>(</span>full.names <span class='op'>=</span> <span class='cn'>TRUE</span>, pattern <span class='op'>=</span> <span class='st'>"TMT"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/basename.html'>basename</a></span><span class='op'>(</span><span class='va'>f</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01-20141210.mzid"</div><div class='input'>
<span class='co'>## mzR parser (default)</span>
<span class='va'>psm</span> <span class='op'>&lt;-</span> <span class='fu'>PSM</span><span class='op'>(</span><span class='va'>f</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required namespace: mzR</span></div><div class='input'><span class='va'>psm</span>
</div><div class='output co'>#&gt; PSM with 5802 rows and 35 columns.
#&gt; names(35): sequence spectrumID ... subReplacementResidue subLocation</div><div class='input'>
<span class='co'>## mzID parser</span>
<span class='fu'>PSM</span><span class='op'>(</span><span class='va'>f</span>, parser <span class='op'>=</span> <span class='st'>"mzID"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required namespace: mzID</span></div><div class='output co'>#&gt; reading TMT_Erwinia_1uLSike_Top10HCD_isol2_45stepped_60min_01-20141210.mzid...</div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt; <span class='warning'>Warning: 'as.is' should be specified by the caller; using TRUE</span></div><div class='output co'>#&gt;  DONE!</div><div class='output co'>#&gt; PSM with 5759 rows and 30 columns.
#&gt; names(30): spectrumid scan number(s) ... spectrumFile databaseFile</div><div class='input'>
<span class='va'>i</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/duplicated.html'>duplicated</a></span><span class='op'>(</span><span class='va'>psm</span><span class='op'>$</span><span class='va'>spectrumID</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>
<span class='va'>i</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>psm</span><span class='op'>$</span><span class='va'>spectrumID</span> <span class='op'>%in%</span> <span class='va'>psm</span><span class='op'>$</span><span class='va'>spectrumID</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>psm2</span> <span class='op'>&lt;-</span> <span class='va'>psm</span><span class='op'>[</span><span class='va'>i</span>, <span class='op'>]</span>
<span class='fu'>reduced</span><span class='op'>(</span><span class='va'>psm2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] NA</div><div class='input'>
<span class='co'>## Peptide sequence CIDRARHVEVQIFGDGKGRVVALGERDCSLQRR with</span>
<span class='co'>## Carbamidomethyl modifications at positions 1 and 28.</span>
<span class='fu'>DataFrame</span><span class='op'>(</span><span class='va'>psm2</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sequence"</span>, <span class='st'>"spectrumID"</span>, <span class='st'>"modName"</span>, <span class='st'>"modLocation"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
</div><div class='output co'>#&gt; DataFrame with 6 rows and 4 columns
#&gt;                 sequence             spectrumID         modName modLocation
#&gt;              &lt;character&gt;            &lt;character&gt;     &lt;character&gt;   &lt;integer&gt;
#&gt; 1 CIDRARHVEVQIFGDGKGRV.. controllerType=0 con.. Carbamidomethyl           1
#&gt; 2 CIDRARHVEVQIFGDGKGRV.. controllerType=0 con.. Carbamidomethyl          28
#&gt; 3       KCNQCLKVACTLFYCK controllerType=0 con.. Carbamidomethyl           2
#&gt; 4       KCNQCLKVACTLFYCK controllerType=0 con.. Carbamidomethyl           5
#&gt; 5       KCNQCLKVACTLFYCK controllerType=0 con.. Carbamidomethyl          10
#&gt; 6       KCNQCLKVACTLFYCK controllerType=0 con.. Carbamidomethyl          15</div><div class='input'><span class='fu'>reduced</span><span class='op'>(</span><span class='va'>psm2</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='cn'>FALSE</span>

<span class='va'>rpsm2</span> <span class='op'>&lt;-</span> <span class='fu'>reducePSMs</span><span class='op'>(</span><span class='va'>psm2</span>, <span class='va'>psm2</span><span class='op'>$</span><span class='va'>spectrumID</span><span class='op'>)</span>
<span class='va'>rpsm2</span>
</div><div class='output co'>#&gt; Reduced PSM with 2 rows and 35 columns.
#&gt; names(35): sequence spectrumID ... subReplacementResidue subLocation</div><div class='input'><span class='fu'>DataFrame</span><span class='op'>(</span><span class='va'>rpsm2</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sequence"</span>, <span class='st'>"spectrumID"</span>, <span class='st'>"modName"</span>, <span class='st'>"modLocation"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
</div><div class='output co'>#&gt; DataFrame with 2 rows and 4 columns
#&gt;                                                    sequence    spectrumID
#&gt;                                                 &lt;character&gt;   &lt;character&gt;
#&gt; controllerType=0 controllerNumber=1 scan=5490 KCNQCLKVAC... controller...
#&gt; controllerType=0 controllerNumber=1 scan=6518 CIDRARHVEV... controller...
#&gt;                                                     modName   modLocation
#&gt;                                                 &lt;character&gt; &lt;IntegerList&gt;
#&gt; controllerType=0 controllerNumber=1 scan=5490 Carbamidom...    2,5,10,...
#&gt; controllerType=0 controllerNumber=1 scan=6518 Carbamidom...          1,28</div><div class='input'><span class='fu'>reduced</span><span class='op'>(</span><span class='va'>rpsm2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'>## ---------------------------------</span>
<span class='co'>## Multiple mzid files</span>
<span class='co'>## ---------------------------------</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/lgatto/rpx'>rpx</a></span><span class='op'>)</span>
<span class='va'>PXD022816</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/rpx/man/PXDataset-class.html'>PXDataset</a></span><span class='op'>(</span><span class='st'>"PXD022816"</span><span class='op'>)</span>
<span class='va'>PXD022816</span>
</div><div class='output co'>#&gt; Object of class "PXDataset"
#&gt;  Id: PXD022816 with 32 files
#&gt;  [1] 'QEP2LC6_HeLa_50ng_251120_01-calib.mzID.gz' ... [32] 'checksum.txt'
#&gt;  Use 'pxfiles(.)' to see all files.</div><div class='input'>
<span class='op'>(</span><span class='va'>mzids</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/rpx/man/PXDataset-class.html'>pxget</a></span><span class='op'>(</span><span class='va'>PXD022816</span>, <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='st'>"mzID"</span>, <span class='fu'><a href='https://rdrr.io/pkg/rpx/man/PXDataset-class.html'>pxfiles</a></span><span class='op'>(</span><span class='va'>PXD022816</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading QEP2LC6_HeLa_50ng_251120_01-calib.mzID.gz from cache.</span></div><div class='output co'>#&gt; <span class='message'>Loading QEP2LC6_HeLa_50ng_251120_02-calib.mzID.gz from cache.</span></div><div class='output co'>#&gt; [1] "~/.cache/rpx/8dc56596c3f_QEP2LC6_HeLa_50ng_251120_01-calib.mzID.gz"
#&gt; [2] "~/.cache/rpx/8dc3f02b93_QEP2LC6_HeLa_50ng_251120_02-calib.mzID.gz" </div><div class='input'><span class='va'>psm</span> <span class='op'>&lt;-</span> <span class='fu'>PSM</span><span class='op'>(</span><span class='va'>mzids</span><span class='op'>)</span>
<span class='va'>psm</span>
</div><div class='output co'>#&gt; PSM with 50314 rows and 31 columns.
#&gt; names(31): sequence spectrumID ... subReplacementResidue subLocation</div><div class='input'>
<span class='co'>## Here, spectrum identifiers are repeated accross files</span>
<span class='va'>psm</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span><span class='op'>(</span><span class='st'>"scan=20000"</span>, <span class='va'>psm</span><span class='op'>$</span><span class='va'>spectrumID</span><span class='op'>)</span>, <span class='st'>"spectrumFile"</span><span class='op'>]</span>
</div><div class='output co'>#&gt; [1] "P:\\Projects\\Morgenstern\\HF2_QC_for_the_paper\\QEP2\\2020-11-29-13-56-12\\Task1-CalibrateTask\\QEP2LC6_HeLa_50ng_251120_01-calib.mzML"
#&gt; [2] "P:\\Projects\\Morgenstern\\HF2_QC_for_the_paper\\QEP2\\2020-11-29-13-56-12\\Task1-CalibrateTask\\QEP2LC6_HeLa_50ng_251120_02-calib.mzML"</div><div class='input'>
<span class='co'>## Let's create a new primary identifier composed of the scan</span>
<span class='co'>## number and the file name</span>
<span class='va'>psm</span><span class='op'>$</span><span class='va'>pkey</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span><span class='op'>(</span><span class='st'>"^.+Task\\\\"</span>, <span class='st'>""</span>, <span class='va'>psm</span><span class='op'>$</span><span class='va'>spectrumFile</span><span class='op'>)</span>,
                  <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span><span class='op'>(</span><span class='st'>"^.+scan="</span>, <span class='st'>""</span>, <span class='va'>psm</span><span class='op'>$</span><span class='va'>spectrumID</span><span class='op'>)</span>,
                  sep <span class='op'>=</span> <span class='st'>"::"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>psm</span><span class='op'>$</span><span class='va'>pkey</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "QEP2LC6_HeLa_50ng_251120_01-calib.mzML::3426" 
#&gt; [2] "QEP2LC6_HeLa_50ng_251120_01-calib.mzML::20165"
#&gt; [3] "QEP2LC6_HeLa_50ng_251120_01-calib.mzML::20180"
#&gt; [4] "QEP2LC6_HeLa_50ng_251120_01-calib.mzML::15180"
#&gt; [5] "QEP2LC6_HeLa_50ng_251120_01-calib.mzML::10327"
#&gt; [6] "QEP2LC6_HeLa_50ng_251120_01-calib.mzML::12894"</div><div class='input'>
<span class='co'>## the PSM is not reduced</span>
<span class='fu'>reduced</span><span class='op'>(</span><span class='va'>psm</span>, <span class='st'>"pkey"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] FALSE</div><div class='input'><span class='fu'>DataFrame</span><span class='op'>(</span><span class='va'>psm</span><span class='op'>[</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>7</span>, <span class='op'>]</span><span class='op'>)</span>
</div><div class='output co'>#&gt; DataFrame with 2 rows and 32 columns
#&gt;        sequence    spectrumID chargeState      rank passThreshold
#&gt;     &lt;character&gt;   &lt;character&gt;   &lt;integer&gt; &lt;integer&gt;     &lt;logical&gt;
#&gt; 1 SEGSSCALES... controller...           4         1          TRUE
#&gt; 2 SEGSSCALES... controller...           4         1          TRUE
#&gt;   experimentalMassToCharge calculatedMassToCharge  peptideRef    modNum
#&gt;                  &lt;numeric&gt;              &lt;numeric&gt; &lt;character&gt; &lt;integer&gt;
#&gt; 1                  796.367                796.367        P_19         2
#&gt; 2                  796.367                796.367        P_19         2
#&gt;     isDecoy        post         pre     start       end DatabaseAccess
#&gt;   &lt;logical&gt; &lt;character&gt; &lt;character&gt; &lt;integer&gt; &lt;integer&gt;    &lt;character&gt;
#&gt; 1     FALSE           I           K       220       251         Q58D62
#&gt; 2     FALSE           I           K       220       251         Q58D62
#&gt;   DBseqLength   DatabaseSeq DatabaseDescription scan.start.time acquisitionNum
#&gt;     &lt;integer&gt;   &lt;character&gt;         &lt;character&gt;     &lt;character&gt;      &lt;numeric&gt;
#&gt; 1         387 MNVLLLLVLC...       Q58D62|FET...       32.788864          12894
#&gt; 2         387 MNVLLLLVLC...       Q58D62|FET...       32.788864          12894
#&gt;     spectrumFile        idFile MetaMorpheus.score PSM.level.q.value
#&gt;      &lt;character&gt;   &lt;character&gt;          &lt;numeric&gt;         &lt;numeric&gt;
#&gt; 1 P:\\Project... 8dc56596c3...            31.2586                 0
#&gt; 2 P:\\Project... 8dc56596c3...            31.2586                 0
#&gt;   modPeptideRef       modName   modMass modLocation subOriginalResidue
#&gt;     &lt;character&gt;   &lt;character&gt; &lt;numeric&gt;   &lt;integer&gt;        &lt;character&gt;
#&gt; 1          P_19 Carbamidom...   57.0215           6                 NA
#&gt; 2          P_19 Carbamidom...   57.0215          19                 NA
#&gt;   subReplacementResidue subLocation          pkey
#&gt;             &lt;character&gt;   &lt;integer&gt;   &lt;character&gt;
#&gt; 1                    NA          NA QEP2LC6_He...
#&gt; 2                    NA          NA QEP2LC6_He...</div><div class='input'>
<span class='co'>## same sequence, same spectrumID, same file</span>
<span class='va'>psm</span><span class='op'>$</span><span class='va'>sequence</span><span class='op'>[</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>7</span><span class='op'>]</span>
</div><div class='output co'>#&gt; [1] "SEGSSCALESPGSVPVGICHGSLGEPQGNQGK" "SEGSSCALESPGSVPVGICHGSLGEPQGNQGK"</div><div class='input'><span class='va'>psm</span><span class='op'>$</span><span class='va'>pkey</span><span class='op'>[</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>7</span><span class='op'>]</span>
</div><div class='output co'>#&gt; [1] "QEP2LC6_HeLa_50ng_251120_01-calib.mzML::12894"
#&gt; [2] "QEP2LC6_HeLa_50ng_251120_01-calib.mzML::12894"</div><div class='input'>
<span class='co'>## different modification locations</span>
<span class='va'>psm</span><span class='op'>$</span><span class='va'>modLocation</span><span class='op'>[</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>7</span><span class='op'>]</span>
</div><div class='output co'>#&gt; [1]  6 19</div><div class='input'>
<span class='va'>rpsm</span> <span class='op'>&lt;-</span> <span class='fu'>reducePSMs</span><span class='op'>(</span><span class='va'>psm</span>, <span class='va'>psm</span><span class='op'>$</span><span class='va'>pkey</span><span class='op'>)</span>
<span class='va'>rpsm</span>
</div><div class='output co'>#&gt; Reduced PSM with 32739 rows and 32 columns.
#&gt; names(32): sequence spectrumID ... subLocation pkey</div><div class='input'><span class='fu'>reduced</span><span class='op'>(</span><span class='va'>rpsm</span>, <span class='st'>"pkey"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'>## the two rows are now merged into a single one; the distinct</span>
<span class='co'>## modification locations are preserved.</span>
<span class='op'>(</span><span class='va'>i</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>rpsm</span><span class='op'>$</span><span class='va'>pkey</span> <span class='op'>==</span> <span class='st'>"QEP2LC6_HeLa_50ng_251120_01-calib.mzML::12894"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 2343</div><div class='input'><span class='fu'>DataFrame</span><span class='op'>(</span><span class='va'>rpsm</span><span class='op'>[</span><span class='va'>i</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sequence"</span>, <span class='st'>"pkey"</span>, <span class='st'>"modName"</span>, <span class='st'>"modLocation"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
</div><div class='output co'>#&gt; DataFrame with 1 row and 4 columns
#&gt;                                                      sequence          pkey
#&gt;                                               &lt;CharacterList&gt;   &lt;character&gt;
#&gt; QEP2LC6_HeLa_50ng_251120_01-calib.mzML::12894   SEGSSCALES... QEP2LC6_He...
#&gt;                                                       modName   modLocation
#&gt;                                               &lt;CharacterList&gt; &lt;IntegerList&gt;
#&gt; QEP2LC6_HeLa_50ng_251120_01-calib.mzML::12894   Carbamidom...          6,19</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


